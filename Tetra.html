<DOCTYPE html>
<html><head><title>TETRA</title><script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script><script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script><style>
body{ margin: 0; }

#fuelbar_outline{border: 2px solid #8d8d8d; border-radius: 10px; width: 200px; height: 19px; position: absolute; left: 40%; top:50px;}
#fuelbar{border-radius: 8px; width: 160px; height: 20px; position: absolute; left: 40%; top:52px; background-color: #8D8D8D;}
</style></head><body><canvas></canvas>
<div id='fuelbar_outline'></div>
<div id='fuelbar'></div>
</body>
<script>
	var canvas = document.querySelector('canvas');
	var timeout = false;
	var c = canvas.getContext('2d');
	
	function getDimensions(){
		canvas.width = window.innerWidth;
		canvas.height = window.innerHeight;	
	}
	window.addEventListener('resize', function(){
		clearTimeout(timeout);
		timeout = setTimeout(getDimensions, 250);
	});

	function Particle(x,y,decay){
		this.x = x;
		this.y = y;
		this.decay = decay;
		this.radius = Math.random()*10;
		this.xspeed = (Math.random()-0.5)/7;
		this.yspeed = (Math.random()-0.5)/7;
		this.draw = function(){
			c.beginPath();
			c.arc(this.x, this.y, this.radius, Math.PI * 2, false);
			c.fillStyle = '#000000';
			c.fill();
		}

		this.update = function(){
			this.radius -= decay;
			if(this.radius < 0){
				this.reset();
			}
			this.x += this.xspeed;
			this.y += this.yspeed;
			this.draw();
		}

		this.reset = function(){
			this.x = x; this.y = y;
			this.radius = Math.random()*10;
			this.xspeed = (Math.random()-0.5)/7;
			this.yspeed = (Math.random()-0.5)/7;
		}
	}

	function Sun(x,y){
		this.x = x;
		this.y = y;
		this.draw = function(){
			c.beginPath();
			c.arc(this.x, this.y, 20, Math.PI*2, false);
			c.fillStyle='#FFFFFF';
			c.strokeStyle='#000000';
			c.lineWidth = 2;
			c.stroke();
			c.fill();
		}
	}

	function Planet(x,y,radius,distance, Sun){
		this.x = x;
		this.y = y;
		this.radius = radius;
		this.distance = distance;
		this.velocity = (Math.random()-0.5)/100;
		this.orgV = this.velocity;
		this.dx = this.velocity;
		this.dy = this.velocity;
		var chance = Math.random();
		this.color;
		if(chance < 0.2){
			this.color = '#8D8D8D';
		} else if(chance < 0.4){
			this.color = '#FF0000';
		} else if(chance < 0.6){
			this.color = '#00C4FF';
		} else {
			this.color = '#000000';
		}
		this.draw = function(){
			c.beginPath();
			c.arc(this.x, this.y, this.radius, Math.PI*2, false);
			c.fillStyle = this.color;
			c.fill();
		}

		this.update = function(){
			this.dx += this.velocity;
			this.dy += this.velocity;
			this.x = Sun.x + (Math.sin(this.dx) * this.distance);
			this.y = Sun.y + (Math.cos(this.dy) * this.distance );
			this.draw();
		}

		this.reset = function(){
			this.velocity = this.orgV;
		}
	}

	function Moon(x,y,radius, distance, planet){
		this.x = x;
		this.y = y;
		this.radius = radius;
		this.distance = distance;
		this.velocity = (Math.random()-0.5)/10;
		this.orgV = this.velocity;
		this.dx = this.velocity;
		this.dy = this.velocity;
		this.myplanet = planet;
		var chance = Math.random();
		this.color;
		if(chance < 0.5){
			this.color = '#8D8D8D';
		} else if(chance < 0.6){
			this.color = '#FF0000';
		} else {
			this.color = '#000000';
		}
		this.draw = function(){
			c.beginPath();
			c.arc(this.x, this.y, this.radius, Math.PI*2, false);
			c.fillStyle= this.color;
			c.fill();
		}

		this.update = function(){
			this.dx += this.velocity;
			this.dy += this.velocity;
			this.x = planet.x + (Math.sin(this.dx) * this.distance);
			this.y = planet.y + (Math.cos(this.dy) * this.distance);
			this.draw();
		}

		this.reset = function(){
			this.velocity = this.orgV;
		}

	}

	function ConnectingPlanetLine(sun, planet){
		this.sx = sun.x;
		this.sy;
		this.ex;
		this.ey;
		
		this.draw = function(){
			this.sx = sun.x;
			this.sy = sun.y;
			this.ex = planet.x;
			this.ey = planet.y;
			c.beginPath();
			c.strokeStyle = '#cdcdcd';
			c.lineWidth = 1;
		}

		this.update = function(){
			this.draw();
			c.moveTo(this.sx, this.sy);
			c.lineTo(this.ex, this.ey);
			c.stroke();
		}
	}

	function ConnectingMoonLine(planet, moon){
		this.sx;
		this.sy;
		this.ex;
		this.ey;
		
		this.draw = function(){
			this.sx = planet.x;
			this.sy = planet.y;
			this.ex = moon.x;
			this.ey = moon.y;
			c.beginPath();
			c.strokeStyle = '#cdcdcd';
			c.lineWidth = 1;
		}

		this.update = function(){
			this.draw();
			c.moveTo(this.sx, this.sy);
			c.lineTo(this.ex, this.ey);
			c.stroke();
		}
	}

	var particleArray = [];
	for(var p = 0; p < 300; p++){
		particleArray.push(new Particle(innerWidth/2+(Math.random()-0.5)*15, innerHeight/2+(Math.random()-0.5)*15, 0.02));
	}
	var sunArray = [];
	for(var s = 0; s < 1; s++){
		sunArray.push(new Sun(innerWidth/2, innerHeight/2));
	}

	var planetArray = [];
	var randomP = getRandomInt(2, 4);
	for(var a = 0; a < randomP; a++){
		planetArray.push(new Planet(innerWidth/2 + Math.random() * 30, innerHeight/2, getRandomInt(5,11), a * 80 + 100, sunArray[0]));
	}

	var moonArray = [];
	for(var mp = 0; mp < planetArray.length; mp++){
		//if(Math.random() > 0.35){
			var moonCount = Math.floor(Math.random()*4);
			for(var m = 0; m < moonCount; m++){
				moonArray.push(new Moon(planetArray[mp].x, planetArray[mp].y, getRandomInt(2,4), (10 * m)+ 15, planetArray[mp]));
			}
		//}
	}

	var lineCount = planetArray.length + moonArray.length;
	var lineArray = [];
	for(var l = 0; l < lineCount; l++){
		if(l < planetArray.length){
			lineArray.push(new ConnectingPlanetLine(sunArray[0],planetArray[l]));
		} else {
			var mindex = l-(planetArray.length);
			console.log(mindex);
			lineArray.push(new ConnectingMoonLine(moonArray[mindex].myplanet, moonArray[mindex]));
		}
	}

	var focusedElement = sunArray[0];
	function animate(){
		getDimensions();
		requestAnimationFrame(animate);
		c.clearRect(0,0,innerWidth,innerHeight);
		for(var l = 0; l < lineArray.length; l++){
			lineArray[l].update();
		}
		for(var i = 0; i < particleArray.length; i++){
			particleArray[i].update();
		}
		sunArray[0].draw();
		for(var j = 0; j < planetArray.length; j++){
			planetArray[j].update();
		}
		for(var m = 0; m < moonArray.length; m++){
			moonArray[m].update();
		}
		

		
	}

	function getRandomInt(min, max) {
  		min = Math.ceil(min);
  		max = Math.floor(max);
  		return Math.floor(Math.random() * (max - min)) + min; //The maximum is exclusive and the minimum is inclusive
	}

	function isIntersect(point, circle) {
  		return Math.sqrt((point.x-circle.x) ** 2 + (point.y - circle.y) ** 2) < circle.radius;
	}

	canvas.addEventListener('click', (e) => {
		  const pos = {
		    x: e.clientX,
		    y: e.clientY
		  };
	 	 planetArray.forEach(Planet => {
		    if (isIntersect(pos, Planet)) {
		      focusedElement = Planet;
		      console.log(focusedElement);
		    }
	  	});
	  	sunArray.forEach(Sun =>{
		  if(isIntersect(pos, Sun)){
		  	console.log('Sun');
		  	focusedElement = Sun;
		  }
		});
	});

	
	animate();

</script></html>

