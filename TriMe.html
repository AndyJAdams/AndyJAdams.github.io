<!DOCTYPE html><html><head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<style>
  body{ 
    margin:0; 
    font-size: 24pt;
    font-family: sans-serif;
  }

  .triangle{
    width: 80px;
    height: 80px;
    background-color: #DDD;
    position: absolute;
  }
  .up{
    clip-path: polygon(50% 0, 0 100%, 100% 100%);
  }

  .down{
    clip-path: polygon(0 0, 100% 0, 50% 100%);
  }
</style>
<title>TRI ME</title></head>
<body id='body'>
  <!--<canvas id='canvas'></canvas>-->
  <h3 id='playerDisplay'>Player: 1</h3>
  <div id='content'>
    
  <div>
</body>
<script>
  $(document).ready(function(){
    $('#playerDisplay').css('color', '#000');
    var rows = 6;
    var tilesPerRow = 9;
    var playerCount = 2;
    var activePlayer = 0; 
    var playerColors = ['#000','#0F0','#F00','#00F'];

    function makeGrid(){
      var scale = 80; //Set this equal to the value of width in the .triangle declaration of CSS
      var c = $('#content');
      var index = 0;
      var up = false;
      for(var r = 0; r < rows; r++){
        var TOP = (r*scale)+scale+(r*5);
        if(r%2==0){
          up = false;
        } else {
          up = true;
        }
        for(var t = 0; t < tilesPerRow; t++){
          var LEFT = (t * (scale/2))+(t*5);
          if(!up){
            c.append("<div class='triangle down' id='"+index+"' row='"+r+"' style='top:"+TOP+"px; left:"+LEFT+"px;'></div>")
          } else {
            c.append("<div class='triangle up' id='"+index+"' row='"+r+"' style='top:"+TOP+"px; left:"+LEFT+"px;'></div>")
          }
          index++;
          up = !up;
        }
      }
    }    

    $('.triangle').on('click',function(){
      if($(this).attr('name') != 'blocked'){
        $(this).css('background-color', playerColors[activePlayer]);
        $(this).attr('name', 'blocked');
        activePlayer++;
        if(activePlayer>playerCount-1){
          activePlayer=0;
        }
        $('#playerDisplay').html('Player:'+(activePlayer+1));
        $('#playerDisplay').css('color', playerColors[activePlayer]);
        validate();
      } 
    });

    function validate(){
      for(var i = 0; i < tilesPerRow*rows;i++){
        var index = i;
        var tri = $('#'+(i));
        var row = parseInt(tri.attr('row'));
        var color = [];
        var changeOccured = false;
        if(index-1 > -1){
          var last = $('#'+(index-1));
          if(last.attr('row') == row && last.attr('name') == 'blocked'){
            color.push(last.css('background-color'));
          }
        }
        if(index+1 < tilesPerRow*rows){
          var next = $('#'+(index+1));
          if(next.attr('row')==row && next.attr('name') == 'blocked'){
            color.push(next.css('background-color'));
          }
        }
        var dir = tri.attr('class');
        if(dir =='triangle up'){
          if(index+tilesPerRow < tilesPerRow*rows){
            var third = $('#'+(index+tilesPerRow));
            if(third.attr('name')=='blocked'){
              color.push(third.css('background-color'));
            }
          }
        } else {
          if(index-tilesPerRow > -1){
            var third = $('#'+(index-tilesPerRow));
            if(third.attr('name')=='blocked'){
              color.push(third.css('background-color'));
            }
          }
        }
        //Loop through all colors and find matches
        for(var c = 0; c < color.length; c++){
          for(var n = c+1; n < color.length; n++){
            if(color[n] == color[c]){
              tri.css('background-color',color[c]);
              changeOccured = true;
            }
          } 
        }
      }
      if(changeOccured){
        validate();
      } else {
        checkWinner();
      }
    }

    function chekWinner(){
      var count = 0;
      for(var i = 0; i < tilesPerRow*rows; i++){
        if($('#'+i).attr('name')!='blocked'){
          count++;
        }
      }
      if(count == 0){
        //A winner has been found... display. 
      }
    }
    
    makeGrid();
  });

  /*
  <div class='triangle up' id='0' style='top: 30px; left: 30px;'></div>
    <div class='triangle down' id='1' style='top: 30px; left: 75px;'></div>
    <div class='triangle up' id='2' style='top: 30px; left: 120px;'></div>
    <div class='triangle down' id='3' style='top: 30px; left: 165px;'></div>
    <div class='triangle up' id='4' style='top: 30px; left: 210px;'></div>
    <div class='triangle down' id='5' style='top: 30px; left: 255px;'></div>
    <div class='triangle down' id='5' style='top: 115px; left: 30px;'></div>
    <div class='triangle up' id='0' style='top: 200px; left: 30px;'></div>
    */



  /* CANVAS ATTEMPT
  var canvas = document.getElementById('canvas');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  var c = canvas.getContext('2d');
  // c.beginPath();
  // c.moveTo(100,100);
  // c.lineTo(200,100);
  // c.lineTo(150,150);
  // c.lineTo(100,100);
  // c.stroke();
  var rows = 7;
  var tpr = 15; //Tiles Per Row
  var sizeSetting = 80;
  var triArray = [];
  var index = 0;

  for(var r = 0; r < rows; r++){
    var inverter = 0; 
    for(var i = 0; i < tpr; i++){
      inverter++;
      var invert = false;
      if(index%2!=0){
        invert = true;
      }
      if(i%2==0){
          inverter--;
      }
      var sx = (inverter*sizeSetting)+sizeSetting;
      if(r%2 != 0){
        sx += (sizeSetting/2); 
        if(!invert){
          sx-=sizeSetting;
        }
        console.log('OffsetRow '+r + " i:"+ index + " invert:"+invert + " val:"+ inverter + " sx:"+sx);
      }

      
      var sy = (r*sizeSetting)+(sizeSetting/1.25);
      triArray.push(new Triangle(index, invert, sx, sy, sizeSetting));
      index++;
    }
  }

  function animate(){
    requestAnimationFrame(animate);
    c.clearRect(0,0,innerWidth,innerHeight);

    for(var i = 0; i < triArray.length; i++){
      triArray[i].draw();
    }
  }

  function Triangle(index, inversion, startX, startY, size){
    this.index = index;
    this.inversion = inversion;
    this.sx = startX;
    this.sy = startY;
    this.size = size;

    this.draw = function(){
      c.beginPath();
      c.moveTo(this.sx, this.sy);
      if(!this.inversion){
        c.lineTo(this.sx+this.size, this.sy);
        c.lineTo(this.sx+(this.size-(this.size/2)),this.sy+(this.size));
        c.lineTo(this.sx, this.sy);
      } else {
        c.lineTo(this.sx+(this.size/2),this.sy+(this.size));
        c.lineTo(this.sx-(this.size/2),this.sy+(this.size));
        c.lineTo(this.sx, this.sy);
        
      }
      c.fillStyle ='#CCC';
      c.fill();
      c.stroke();
    }
  }

  animate();
  */
</script>
</html>