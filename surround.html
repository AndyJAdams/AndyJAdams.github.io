<!DOCTYPE HTML>
<html>
<head>
    <meta lang="en/us"/>
    <meta encoding="UTF-8">
    <meta charset="UTF-8">
    <title>init</title>
    <style>
        body{
            margin: 0;
            touch-action: none;
            position: fixed;
            -webkit-touch-callout: none !important;
            -webkit-user-select: none !important;
        }
        canvas{
            background-color:#000;
        }
    </style>
</head>
<body>
<button id='allow' onclick='onClick()'>Allow Orientation Control</button>
<canvas id='canvas'></canvas>
<script type='text/javascript'>
     var canvas = document.getElementById('canvas');
    var ctx = canvas.getContext('2d');
    var a = 0;
    var b = 0;
    var g = 0;

    var pb = 0;
    var pg = 0; 
    
    function scaleCanvas(){
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    scaleCanvas();

    function Crosshair(x,y){
        this.x = x;
        this.y = y;
        this.draw = function(){
            ctx.strokeStyle='#0F0';
            ctx.beginPath();
            ctx.moveTo(this.x-100,this.y);
            ctx.lineTo(this.x+100,this.y);
            ctx.stroke();
            ctx.closePath();

            ctx.strokeStyle='#FFF';
            ctx.beginPath();
            ctx.moveTo(this.x,this.y-100);
            ctx.lineTo(this.x,this.y+100);
            ctx.stroke();
            ctx.closePath();
        }

        this.update = function(){
            this.x += b-pb;
           this.draw(); 
        }
    }

    var ch = new Crosshair(innerWidth/2,innerHeight/2);

    
    function animate(){
        window.requestAnimationFrame(animate);
        ctx.clearRect(0,0,innerWidth,innerHeight);
        ctx.font='bold 32px sans-serif';

        ctx.fillStyle='#F00';
        ctx.fillText("A: "+a,10,30);
        ctx.fillStyle='#0F0';
        ctx.fillText('B: '+b,10,80);
        ctx.fillStyle='#FFF';
        ctx.fillText('G: '+g,10,130);

        ch.update();
    }

    function onClick(){
        console.log("allowing control");
        if (typeof DeviceOrientationEvent.requestPermission === 'function') {
          DeviceOrientationEvent.requestPermission()
            .then(permissionState => {
              if (permissionState === 'granted') {
                window.addEventListener('deviceorientation',handleOrientation);
              }
            })
            .catch(console.error);
        } else {
          window.addEventListener('deviceOrientation', handleOrientation);
        }
    }

    function handleOrientation(evt){
        pb = b;
        pg = g;
        a = Math.round(evt.alpha);
        b = Math.round(evt.beta);
        g = Math.round(evt.gamma);
    }

    animate();
    
</script>
</body>
</html>