<!DOCTYPE HTML>
<html>
<head>
<meta lang="en/us"/>
<meta encoding="UTF-8">
<title>TEST BED</title>
<style>
body{
margin: 0;
}
#canvas{
background-color:#eee;
}
</style>
</head>
<body>
<canvas id='canvas'></canvas>
<script type='text/javascript'>
    var gridSizeX = 5;
    var gridSizeY = 9;
    var colorArray = ['#00B3E6','#B33300','#66991A','#7B7B7B','#6666FF','#FF6633'];
    var debug = true;

    var canvas = document.getElementById('canvas');
    var ctx = canvas.getContext('2d');
    ctx.font = "12px Helvetica";
    var center = {
        x: 0,
        y: 0
    }
    var tileSize = 0;
    function scaleCanvas(){
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        center.x = canvas.width/2;
        center.y = canvas.height/2;
        tileSize = canvas.width/(gridSizeX+2);
    }
    scaleCanvas();

    function Tile(x,y,w,h,c=0,r=0, color = '#0F0'){
        this.x = x; this.y = y; this.w = w; this.h = h;
        this.r = r; this.c = c; this.dx = this.x; this.dy = this.y;
        this.col = color;
        this.xspeed = 1;
        this.yspeed = 1;
        
        this.draw = function(){
            ctx.fillStyle= this.col;
            ctx.fillRect(this.x, this.y, this.w, this.h);
            if(debug){
                ctx.fillStyle='#000';
                ctx.fillText(this.r+","+this.c,this.x+2, this.y+10);
            }
        }

        this.update = function(){
            if(this.y > this.dy){
                this.yspeed = Math.abs(this.dy-this.y)/10;
                this.y-=this.yspeed;
            } else if(this.y < this.dy){
                this.yspeed = Math.abs(this.dy-this.y)/10;
                this.y+=this.yspeed;
            }

            if(this.x > this.dx){
                this.xspeed = Math.abs(this.dx-this.x)/10;
                this.x-= this.xspeed;
            } else if(this.x < this.dx){
                this.xspeed = Math.abs(this.dx-this.x)/10;
                this.x+= this.xspeed;
            }
            this.draw();
        }

        this.move = function(pos){
            //this.dx = pos.y;
            //this.dy = pos.x;
            this.x = pos.y;
            this.y = pos.x;
        }

        this.scale = function(w,h){
            this.w = w;
            this.h = h;
        }

        this.setColor = function(color){
            this.col = color;
        }
    }
    
    function Position(x,y){
        this.x = x;
        this.y = y;
    }

    var positions = [];
    var tiles = [];
    var gridWidth = tileSize*gridSizeX;
    var gridHeight = tileSize*gridSizeY;
    var colCount = 0;
    for(var i = 0; i < gridSizeX; i++){
        var row = [];
        var pos = [];
        for(var j = 0; j < gridSizeY; j++){
            var tx = center.x+((i*tileSize)-(gridWidth/2));
            var ty = center.y+((j*tileSize)-(gridHeight/2));
            pos.push(new Position(tx,ty));
            var tcolor = Math.floor(Math.random()*colorArray.length);
            
            row.push(new Tile(tx,ty,tileSize-5,tileSize-5,i,j,colorArray[tcolor]));
            colCount++;
        }
        tiles.push(row);
        positions.push(pos);
    }
    var t = new Tile(innerWidth/2-tileSize/2, innerHeight/2-tileSize/2, tileSize,tileSize,1,1,'#000');

    //==================================================================================================
    //==================================================================================================
    
    function animate(){
        window.requestAnimationFrame(animate);
        ctx.clearRect(0,0,innerWidth,innerHeight);
        for(var i = 0; i < gridSizeX; i++){
            for(var j = 0; j < gridSizeY; j++){
                tiles[i][j].update();
            }
        }
        //t.update();

    }
    
    //==================================================================================================
    //==================================================================================================
    
    function getCloseTile(cx,cy){
        for(var i = 0; i < gridSizeX; i++){
            for(var j = 0; j < gridSizeY; j++){
                var tx = tiles[i][j].x;
                var ty = tiles[i][j].y;
                if(tx < cx && tx+tileSize > cx && ty < cy && ty+tileSize > cy){
                    return tiles[i][j];
                }
            }
        }
        return null;
    }
    
    function getRow(trow){
        var row = [];
        for(var i = 0; i < gridSizeX; i++){
            for(var j = 0; j < gridSizeY; j++){
                if(tiles[i][j].r == trow){
                    row.push(tiles[i][j]);
                }
            }
        }
        return row;
    }
    
    function getColumn(tcol){
        var col = [];
        for(var i = 0; i < gridSizeX; i++){
            for(var j = 0; j < gridSizeY; j++){
                if(tiles[i][j].c == tcol){
                    col.push(tiles[i][j]);
                }
            }
        }
        return col;
    }
    
    function getPosition(x,y){
        return positions[x][y];
    }
    
    var mx,my;
    var drag = false;
    var rowORcolumn = -1; //0 for row and 1 for column
    var close = null;
    window.addEventListener('mouseup',function(evt){    
        rowORcolumn = -1;
        close = null;
        drag = false;
    });
    
    window.addEventListener('mousedown',function(evt){
        mx = evt.pageX;
        my = evt.pageY;
        close = getCloseTile(mx,my);
        if(close != null){
            drag = true;
            console.log("DRAGGING " + close.r + "," + close.c);
        }
        
    });
    
    window.addEventListener('mousemove',function(evt){
        if(drag){
        var cx = evt.pageX;
        var cy = evt.pageY;
        if(rowORcolumn < 0){
            var xdif = Math.abs(cx-mx);
            var ydif = Math.abs(cy-my);
            if(xdif > ydif){
                rowORcolumn = 0;
                
            } else if(ydif > xdif){
                rowORcolumn = 1;
            }
        } else if(rowORcolumn == 0){
            console.log("ROW " + close.r);
            //Get all the tiles in the current row
            var row = getRow(close.r);
            if(row.length > 0 && Math.abs(cx-mx) > tileSize){//insure we actually have some tiles;
                if(cx > mx){//Right
                    console.log("RIGHT");
                    //Cycle the entire row to the right one space
                    for(var a = 0; a < row.length; a++){
                       row[a].setColor('#F00');
                    }
                    
                } else if(cx<mx){
                    console.log("LEFT");
                    for(var b = 0; b < row.length; b++){
                        row[b].setColor('#00F');
                    }
                    
                }
                mx = cx;
            }
        } else {
            console.log("COLUMN " + close.c);
            var col = getColumn(close.c);
            if(col.length > 0 && Math.abs(cy-my) > tileSize){
                if(cy > my){ 
                    console.log("DOWN");
                    for(var d = 0; d < col.length; d++){
                        col[d].setColor('#0F0');
                    }
                } else if(my > cy){
                    console.log("UP");
                    for(var u = 0; u < col.length; u++){
                        col[u].setColor('#FFF');
                    }
                }
                my = cy;
            }    
            
        }
        }
    });

    scaleCanvas();
    animate();
</script>
</body>
</html>