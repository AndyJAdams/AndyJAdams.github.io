<!DOCTYPE html>
<html lang="en US">
  <head>
    <title>JUICY</title>
    <meta charset="utf-8">
  </head>

  <body>
    <button id='loc'>Allow Location</button>
    <button id='stat'>GetStationList</button>
    <p id='out'></p>
  </body>
  <script>
    var loc ={long: -1,lat: -1};
    var distanceLimit = 40; //defaults to miles
    function getLoc(){
      if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(stashLoc);
      } else {
        console.log("Get rinsed")
      }
    }
    function stashLoc(position){
      console.log(position);
      loc.long = position.coords.longitude;
      loc.lat = position.coords.latitude;
      console.log(loc);
    }
    var baseURL = 'https://api.openchargemap.io/v3/poi/?';
    const ua = async () =>{
      //getLoc();
      let locURL = baseURL+'longitude='+loc.long+'&latitude='+loc.lat+'&distance='+distanceLimit;
      let myURL = locURL+'&key=juiceboxapp';
      console.log(myURL);
      const response = await fetch(myURL);
      const json = await response.json();
      //document.getElementById('out').innerHTML = json.ToString();
      console.log(json);
      document.getElementById('out').innerHTML = json.ToString();
    }

    var LOCbtn = document.getElementById('loc');
    LOCbtn.addEventListener('click',getLoc);
    var staBTN = document.getElementById('stat');
    staBTN.addEventListener('click',ua);

  </script>
</html>
