<DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Sorted</title>
        <style type="text/css">
            body{
                margin: 0;
                touch-action: none;
                position: fixed;
                -webkit-touch-callout: none !important;
                -webkit-user-select: none !important;
                background-color: hsl(0,0%,80%);
            }
            canvas{
                touch-action: none;
            }
        </style>
    </head>
    <body id='body'>
    <canvas></canvas>
        <script type='text/javascript' src='/Util/grid.js'></script>
        <script>
        var canvas = document.querySelector('canvas');
        var half = {x:0,y:0};
        var tileSize = 80;
        
        function scaleCanvas(){
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            half.x = innerWidth/2;
            half.y = innerHeight/2;
        }
        var ctx = canvas.getContext('2d');
        scaleCanvas();
        var grid = new Grid(5,5,tileSize,tileSize,half.x,half.y);
        var count = {current:0,last:0};
        var now = Math.floor(Date.now()/1000);

        //*************************************************
        //*************************************************
        function animate(){
            window.requestAnimationFrame(animate);
            ctx.clearRect(0,0,innerWidth,innerHeight);

            ctx.fillStyle = '#00000066';
            ctx.strokeStyle='#00000022';
            

            //REMOVE BELOW BEFORE PRODUCTION
            ctx.beginPath();
            ctx.moveTo(half.x,0);
            ctx.lineTo(half.x,innerHeight);
            ctx.moveTo(0,half.y);
            ctx.lineTo(innerWidth,half.y);
            ctx.stroke();
            ctx.closePath();

            ctx.beginPath();
            ctx.arc(current.x,current.y,10,0,2*Math.PI);
            ctx.closePath();
            ctx.stroke();

            //Simple FPS tool
            if(Math.floor(Date.now()/1000) == now){
                count.current++;
                ctx.fillText('FPS:'+count.last + " " + now,10,14);
            } else {
                count.last = count.current;
                count.current =0;
                now = Math.floor(Date.now()/1000);
            }

            puzzle.update();

            grid.draw(ctx);


        }
        //*************************************************
        //*************************************************
    
        //*** INPUT SECTION **//
        window.addEventListener('keyup',function(e){
            console.log(e.keyCode);
        });
    
        window.addEventListener('resize',function(evt){
            evt.preventDefault();
            scaleCanvas();
        });
    
    
        window.addEventListener('mousedown',inputStart,false);
        window.addEventListener('mousemove',inputMove,false);
        window.addEventListener('mouseup',inputEnd,false);
    
        window.addEventListener('touchstart',inputStart, false);
        window.addEventListener('touchmove', inputMove,false);
        window.addEventListener('touchcancel',inputEnd,false);
        window.addEventListener('touchend',inputEnd,false);
    
        var start = {x:-1,y:-1};
        var current = {x:-1,y:-1};
        function inputStart(evt){
            evt.preventDefault();
            if(evt.changedTouches != undefined){
                var touches = evt.changedTouches;
                if(touches.length > 0){
                    start.x = touches[0].pageX;
                    start.y = touches[0].pageY;
                }
            } else {
                start.x = evt.pageX;
                start.y = evt.pageY;
            }
            current.x = start.x;
            current.y = start.y;
        }
    
        function inputMove(evt){
            evt.preventDefault();
            //if(start.x > -1){
                if(evt.changedTouches != undefined){
                    var touches = evt.changedTouches;
                    if(touches.length > 0){
                        current.x = touches[0].pageX;
                        current.y = touches[0].pageY;
                    }
                } else {
                    current.x = evt.pageX;
                    current.y = evt.pageY;
                }
            //}
            
        }
    
        function inputEnd(){
            start.x = -1;
        }

        //--------------------------------------------------------------------------------------

        function Tile(row,column){
            this.row = row; this.col = column;
            this.pos = grid.pos[this.row][this.col];
            this.val = -1;
            this.draw = function(){
                ctx.fillStyle='#00000044';
                ctx.fillRect(this.pos.x-tileSize/2+4,this.pos.y-tileSize/2+4,tileSize-8,tileSize-8);
                ctx.fillText(this.val,this.pos.x-tileSize/2+10,this.pos.y-tileSize/2+16);
            }
        }

        function Puzzle(){
            this.tiles = [];
            for(var x = 0; x < 5; x++){
                var row = [];
                for(var y = 0; y < 5; y++){
                    row.push(new Tile(x,y));
                }
                this.tiles.push(row);
                
            }

            this.update = function(){
                for(var i = 0; i < this.tiles.length; i++){
                    for(var j = 0; j < this.tiles[i].length; j++){
                        this.tiles[i][j].draw();
                    }
                }
            }

            this.getTileNeighbors = function(r,c){
                var n = [];
                if(c-1 >-1){
                    n.push(this.tiles[r][c-1]);
                }
                if(r+1 < 5){
                    n.push(this.tiles[r+1][c]);
                }
                if(c+1 > 5){
                    n.push(this.tiles[r][c+1]);
                }
                if(r-1 > -1){
                    n.push(this.tiles[r-1][c]);
                }
                return n;
            }

            this.assignValues = function(){
                //How many colors?
                var colCount = Math.floor(Math.random()*4)+2;
                //Spit the grid even(ish)
                var groupSize = Math.floor(25/colCount);
                //Select a random tile to start
                for(var i = 0; i< colCount; i++){
                    var randR = Math.floor(Math.random()*5);
                    var randC = Math.floor(Math.random()*5);
                    var t = this.tiles[randR][randC];
                    for(var j = 0; j < groupSize;j++){
                        t.val = i;
                        
                    }

                }

            }
            this.assignValues();


        }
        var puzzle = new Puzzle();
        //---------------------------------------------------------------------------------------
        animate();
        </script>
    </body>
    </html>
    
