<DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Deeper Daddy!</title>
	<style type="text/css">
		body{
            margin: 0;
            touch-action: none;
            position: fixed;
            -webkit-touch-callout: none !important;
            -webkit-user-select: none !important;
        }
        canvas{
            touch-action: none;
            background-color: #FFF;
             -webkit-touch-callout: none !important;
            -webkit-user-select: none !important;
        }
	</style>
    
</head>
<body id='body'>
<canvas></canvas>
    <script src="screenshaker.js"></script>
	<script>
    var pause = false;
	var canvas = document.querySelector('canvas');
    var center = {x:0,y:0};
    var end = -2;
    var endTime = 0;
    var depth = 0;
    function scaleCanvas(){
		canvas.width = window.innerWidth;
		canvas.height = window.innerHeight;
        center.x = innerWidth/2;
        center.y = innerHeight/2;
        
	}
	var ctx = canvas.getContext('2d');
    var shaker = new ScreenShaker(ctx);
    var RandEggs = Math.floor(Math.random()*7);
    var RandSTD = Math.floor(Math.random()*5);
    scaleCanvas();

    function Ship(x,y){
        this.x = x; this.y = y;
        this.shrinkage = 0;
        this.swell = 0;
        this.flip = false;
        
        this.draw = function(){
            ctx.lineWidth=4;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.fillStyle='#FFF';
            
            ctx.fillRect(this.x-14,this.y+10,22,20);
            //LEFTY
            ctx.beginPath();
            ctx.arc(this.x-14,this.y+20,10+this.swell,.34*Math.PI,1.5*Math.PI);
            ctx.fill();
            ctx.stroke();
            //drawing the shaft
            //ctx.beginPath();
            ctx.moveTo(this.x-12,this.y+10);
            ctx.lineTo(this.x-12,this.y-this.shrinkage);
            ctx.bezierCurveTo(this.x-20,this.y-5-this.shrinkage,this.x-10,this.y-20-this.shrinkage,this.x,this.y-20-this.shrinkage);
            ctx.lineTo(this.x,this.y-20-this.shrinkage);
            ctx.bezierCurveTo(this.x+10,this.y-20-this.shrinkage,this.x+20,this.y-6-this.shrinkage,this.x+12,this.y-this.shrinkage);
            ctx.lineTo(this.x+12,this.y+10);
            ctx.fill();
            ctx.stroke();
            
            //RIGHTY
            //ctx.beginPath();
            ctx.arc(this.x+14,this.y+20,10+this.swell,1.5*Math.PI,.7*Math.PI);
            
            ctx.fill();
            ctx.stroke();
            
        }
        
        this.update = function(){
            if(this.shrinkage > 0 && startTime < 1){
                this.shrinkage = this.shrinkage*0.5;
            } 
//            if(this.shrinkage > 0){
//                this.shrinkage *= 0.5;
//            }
//            if(this.shrinkage < 1){
//                this.shrinkage = 20;
//            }
            if(this.swell > 0 && startTime < 1){
                this.swell = this.swell*0.5;
            }
            
            if(this.x > innerWidth*0.7){
                this.flip = true;
            } else if(this.x < innerWidth*0.3){
                this.flip = false;
            }
            
            if(this.shrinkage < 10){
                if(this.flip){
                    this.x-= 2;
                } else {
                    this.x+= 2;
                }
            }
            
            for(var s = 0; s < stds.length; s++){
                var d = getDistance(stds[s].x, stds[s].y,this.x, this.y);
                if(d < 40){
                    endTime = Date.now();
                    end = stds[s].t;
                    console.log("END: " + end);
                }
            }
            
            for(var e = 0; e < eggs.length; e++){
                var d = getDistance(eggs[e].x, eggs[e].y, this.x, this.y);
                if(d < 30){
                    eggs[e].reset();
                    shaker.shake(80,1);
                }
            }
            this.draw();
        }
        
    }
        
    function Sperm(x,y,bang){
        this.x = x; this.y =y;
        this.wiggle = 0.2;
        this.counter = 0;
        this.gusto = bang;
        this.head = bang/2;
        this.draw = function(){
            ctx.strokeStyle='#000';
            ctx.lineWidth = 4;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.beginPath();
            ctx.arc(this.x,this.y,6+this.head,0,2*Math.PI);
            ctx.closePath();
            ctx.fillStyle='#FFF';
            ctx.fill();
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(this.x,this.y+6+this.head);
            for(var i = 0; i < 100; i++){
                var wave = Math.sin((this.counter+i)/12);
                ctx.lineTo(this.x+wave,this.y+6+this.head+i/5);
            }
            ctx.stroke();
        }
        
        this.update = function(){
            this.counter+=6;
            this.y-=this.gusto;
            this.gusto *= 0.975;
            if(this.gusto > 0.03){
                this.draw();
            } else {
                this.remove();
            }
        }
        
        this.remove = function(){
            for(var i = 0; i < swimmers.length; i++){
                if(swimmers[i] == this){
                    swimmers.splice(i);
                }
            }
        }
    }
        
    function Egg(x,y){
        this.x = x; this.y = y;this.speed = (Math.random()*innerHeight)/1000+1;
        this.draw = function(){
            ctx.beginPath();
            ctx.fillStyle='#FFF';
            ctx.arc(this.x, this.y,20,0,2*Math.PI);
            ctx.fill();
            ctx.stroke();
        }
        
        this.update= function(){
            for(var i = 0; i < swimmers.length; i++){
                let d = getDistance(swimmers[i].x, swimmers[i].y,this.x, this.y);
                if(d < 20+(swimmers[i].head*2)){
                    SpawnBaby(this.x,this.y);
                    //SpawnEgg();
                    eggTotalCount+=2;
                    if(eggTotalCount%7==0){
                        SpawnEgg();
                    }
                    this.x = center.x+((Math.random()-0.5)*(innerWidth/2));
                    this.y = -50;
                    swimmers[i].remove();
                }
            }
            this.y += Math.sin(2)+this.speed;
            if(this.y < innerHeight+50){
                this.draw();
            } else {
                this.reset();
            }
        }
        
        this.reset = function(){
            this.x = ship.x + (Math.random()-0.5)*10;
            if(this.x < innerWidth*0.15){
                this.x = innerWidth*0.2;
            } else if(this.x > innerWidth*0.85){
                this.x = innerWidth*0.8;
            }
            this.speed = (Math.random()*innerHeight)/1000+1;
            this.y = -50;
        }
    }
        
    function Baby(x,y){
        this.x = x;
        this.y = y;
        this.twist = 0;
        this.draw = function(){
           
            ctx.beginPath();
            ctx.lineWidth = 30;
            ctx.moveTo(this.x, this.y);
            
            ctx.save();
            ctx.translate(this.x,this.y);
            ctx.rotate(this.twist*Math.PI/180);
            ctx.fillStyle='#666';
            ctx.beginPath();
            ctx.arc(0, 0,60,0,2*Math.PI); //Body
            ctx.arc(0, -70,30,0,2*Math.PI); //Head
            ctx.fill();
            ctx.closePath();
            //Draw some arm things
            ctx.beginPath();
            ctx.lineWidth= 30;
            ctx.lineCap = 'round';
            ctx.strokeStyle = '#666';
            ctx.moveTo(0,0);
            ctx.lineTo(-86,-90);
            ctx.moveTo(0,0);
            ctx.lineTo(85,-90);
            ctx.moveTo(0,0);
            ctx.lineTo(50,110);
            ctx.moveTo(0,0);
            ctx.lineTo(-50,110);
            ctx.stroke();
                    
            ctx.translate(-this.x,-this.y);
            ctx.restore();
        }
        
        this.update = function(){
            this.twist += 0.5;
            this.draw();
            this.y *= 1.01;
        }
    }
        
    function STD(x,y){
        this.x = x; this.y = y; this.t = Math.floor(Math.random()*4);
        this.speed = (Math.random()*innerHeight)/1000+1;
        this.twist = 0; this.flip =false; this.pinch = 0;
        this.draw = function(){
            switch(this.t){
                case 0: //SYPHILLIS
                    ctx.save();
                    ctx.translate(this.x,this.y);
                    ctx.rotate(this.twist*Math.PI/180);
                    ctx.lineWidth = 4;
                    ctx.fillStyle='#F08';
                    ctx.strokeStyle='#000';
                    ctx.beginPath();
                    ctx.moveTo(0, -13);
                    ctx.lineTo(15, 0);
                    ctx.lineTo(8, 14);
                    ctx.lineTo(-8,14);
                    ctx.lineTo(-15,0);
                    ctx.closePath();
                    ctx.moveTo(0,-13);
                    ctx.lineTo(0,-20);
                    ctx.moveTo(15,0);
                    ctx.lineTo(21,-3);
                    ctx.moveTo(8,14);
                    ctx.lineTo(15,21);
                    ctx.moveTo(-8,14);
                    ctx.lineTo(-16,22);
                    ctx.moveTo(-15,0);
                    ctx.lineTo(-22,-5);
                    ctx.fill();
                    ctx.stroke();
                    
                    ctx.translate(-this.x,-this.y);
                    ctx.restore();
                    break;
                case 1: //HERPES
                    let amp = this.twist/12;
                    ctx.fillStyle='#0CD';
                    ctx.strokeStyle='#000';
                    ctx.beginPath();
                    ctx.lineWidth = 4;
                    ctx.moveTo(this.x,this.y-6-amp);
                    ctx.lineTo(this.x+6+amp,this.y-4);
                    ctx.lineTo(this.x+6+amp,this.y+4);
                    ctx.lineTo(this.x, this.y+6+amp);
                    ctx.lineTo(this.x-6-amp,this.y+4);
                    ctx.lineTo(this.x-6-amp,this.y-4);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();
                    break;
                case 2: //HPV
                    ctx.save();
                    ctx.translate(this.x,this.y);
                    ctx.rotate(-this.twist*Math.PI/180);
                    ctx.lineWidth = 10;
                    ctx.strokeStyle='#000';
                    ctx.beginPath();
                    ctx.moveTo(0, 0);
                    ctx.lineTo(-23, -14);
                    ctx.moveTo(0, 0);
                    ctx.lineTo(0, 24);
                    ctx.moveTo(0, 0);
                    ctx.lineTo(23,-14);
                    ctx.stroke();
                    
                    ctx.translate(-this.x,-this.y);
                    ctx.restore();
                    break;
                case 3: //Chlamydia
                    ctx.strokeStyle='#000';
                    ctx.lineCap = 'round';
                    ctx.lineWidth =6;
                    ctx.beginPath();
                    ctx.moveTo(this.x-22+this.pinch,this.y+13);
                    ctx.lineTo(this.x-24,this.y);
                    ctx.lineTo(this.x,this.y-15);
                    ctx.lineTo(this.x+24,this.y);
                    ctx.lineTo(this.x+22-this.pinch,this.y+13);
                    ctx.moveTo(this.x-10,this.y-10);
                    ctx.lineTo(this.x-10,this.y-20);
                    ctx.moveTo(this.x+10,this.y-10);
                    ctx.lineTo(this.x+10,this.y-20);
                    ctx.stroke();
                
                    break;
                default:
                    this.t = 1;
                    break;
            }
        }
        
        this.update= function(){
            for(var i = 0; i < swimmers.length; i++){
                let d = getDistance(swimmers[i].x, swimmers[i].y,this.x, this.y);
                if(d < 20+(swimmers[i].head*2)){
                    console.log(this.t);
                    //SpawnSTD();
                    stdTotalCount++;
                    if(stdTotalCount%3==0){
                        SpawnSTD();
                    }
                    this.reset();
                    swimmers[i].remove();
                }
            }
            this.y+= this.speed;
            if(this.y < innerHeight+50){
                this.twist++;
                if(this.twist > 360){
                    this.twist = 0;
                }
                if(this.pinch > 20){
                    this.flip = true;
                } else if(this.pinch <1){
                    this.flip = false;
                }
                
                if(this.flip){
                    this.pinch--;
                } else {
                    this.pinch++;
                }
                this.draw();
            } else {
                this.reset();
            }
        }
        
        this.reset = function(){
            this.speed = (Math.random()*innerHeight)/1000+1;
            this.x = ship.x + (Math.random()-0.5)*10;
            if(this.x < innerWidth*0.15){
                this.x = innerWidth*0.2;
            } else if(this.x > innerWidth*0.85){
                this.x = innerWidth*0.8;
            }
            this.y = -50;
            this.t = Math.floor(Math.random()*4);
            this.twist = 0;
        }
    }
    
    function Wall(sx,sy,len,w,spd,left,fill,stroke){
        this.x = sx;
        this.y = sy;
        this.orgY = this.y;
        this.len = len;
        this.spd = spd;
        this.w = w;
        this.left = left;
        this.fill = fill;
        this.stroke = stroke;
        this.draw = function(){
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(this.x, this.y);
            if(this.left){
                for(var i = 0; i < Math.ceil((innerHeight*1.5)/this.len); i++){
                    ctx.bezierCurveTo(this.x+this.w,this.y+(i*this.len)-(this.len*0.75),this.x+this.w,this.y+(i*this.len)-(this.len*0.25),this.x,this.y+(i*this.len));
                }
                ctx.lineTo(this.x,this.y+Math.ceil((innerHeight*1.5)));
                ctx.lineTo(-450,this.y+Math.ceil((innerHeight*1.5)));
                ctx.lineTo(-450,this.y);
            } else {
                for(var i = 0; i < Math.ceil((innerHeight*1.5)/this.len); i++){
                    ctx.bezierCurveTo(this.x-this.w,this.y+(i*this.len)-(this.len*0.75),this.x-this.w,this.y+(i*this.len)-(this.len*0.25),this.x,this.y+(i*this.len));
                }
                ctx.lineTo(this.x,this.y+Math.ceil((innerHeight*1.5)));
                ctx.lineTo(this.x+450,this.y+Math.ceil((innerHeight*1.5)));
                ctx.lineTo(this.x+450,this.y);
            }
            ctx.closePath();
            ctx.fillStyle=this.fill;
            ctx.fill();
            
            ctx.strokeStyle= this.stroke;
            ctx.stroke();
            
        }
        
        this.update = function(){
            this.y+=this.spd;
            if(this.y > this.orgY+this.len){
                this.y = this.orgY;
                depth += 0.01;
            }
            this.draw();
        }
    }
    
    var ship = new Ship(center.x,innerHeight*0.8);
    var swimmers = [];
    var eggs = [];
    var stds = [];
    var babies = [];
    
    var w = new Wall(innerWidth*0.1,-80,40,20,5,true,'#e0b4db','#000');
    var w2 = new Wall(innerWidth*0.9,-80,40,20,5,false,'#e0b4db','#000');
    var w3 = new Wall(innerWidth*0.2,-80,80,12,2,true,'#ab57a2','#00000000');
    var w4 = new Wall(innerWidth*0.8,-80,80,12,2,false,'#ab57a2','#00000000');
        
    var BabyCount = 0;
    var stdTotalCount = 0;
    var eggTotalCount = 0;
    function SpawnSTD(){
        stdTotalCount++;
        stds.push(new STD(center.x+((Math.random()-0.5)*(innerWidth/2)),-50,stds.length));
    }
        
    function SpawnEgg(){
        eggTotalCount++;
        eggs.push(new Egg(center.x+((Math.random()-0.5)*(innerWidth/2)),-100,eggs.length));
    }
        
    function SpawnBaby(x,y){
        BabyCount++;
        babies.push(new Baby(x,y));
    }
        
    var init = false;
    //*************************************************
    //*************************************************
	function animate(){
		window.requestAnimationFrame(animate);
        
        if(!init){
            SpawnEgg();
            SpawnSTD();
            SpawnSTD();
            init = true;
        }
        if(end < -1){
            if(!pause){
                ctx.clearRect(0,0,innerWidth,innerHeight);

                w3.update();
                w4.update();

                for(var i = 0; i < babies.length; i++){
                    babies[i].update();
                }

                w.update();
                w2.update();

                for(var i = 0; i < swimmers.length; i++){
                    swimmers[i].update();
                }

                if(startTime > 0){
                    if(ship.swell < 8){
                        ship.swell+=0.2;
                        ship.shrinkage += 1;

                    }
                } 

                ship.update();

                for(var i = 0; i < eggs.length;i++){
                    eggs[i].update();
                }

                for(var i = 0; i < stds.length; i++){
                    stds[i].update();
                }

                shaker.update();
                ctx.font = 'bold 58px sans-serif';
                ctx.textAlign='center';
                ctx.fillStyle='#000';
                ctx.fillText((Math.floor(depth*10)/10)+'cm',center.x,60); //(Math.floor(depth*10)/10)
                if(depth < 4){
                    ctx.fillText('Tap to fire - go deep',center.x,innerHeight-50);
                } else if(depth > 20){
                    endTime = Date.now();
                    end = -1;
                }
            } else{
                ctx.font = '72px sans-serif';
                ctx.textAlign='center';
                ctx.fillText('PAUSED',center.x, center.y);

            }//END PAUSE DO NOT REMOVE 
//            ctx.fillStyle='#000';
//            ctx.fillText("E: " + eggs.length,10,10);
//            ctx.fillText("X: " + stds.length,10,30);
//            ctx.fillText("S: " + swimmers.length,10,50);
        } else {
            ctx.clearRect(0,0,innerWidth,innerHeight);
            ctx.font = '64px sans-serif';
            ctx.textAlign='center';
            switch(end){
                case 0: //SYPHILLIS
                    ctx.font = '42px sans-serif';
                    ctx.fillText('YOU GOT SYPHILLIS!',center.x, center.y-20);
                    break;
                case 1: //HERPES
                    ctx.fillText('YOU GOT HERPES!',center.x, center.y-20);
                    break;
                case 2: //HPV
                    ctx.fillText('YOU GOT HPV!',center.x, center.y-20);
                    break;
                case 3: //Chlamydia
                    ctx.fillText('YOU GOT CHLAMYDIA!',center.x, center.y-20);
                    break;
                case -1:
                    ctx.fillText('YOU HIT THE G-SPOT!',center.x, center.y-20);
                    break;
                default:
                    end = 0;
                    break;
            }
            ctx.font = '24px sans-serif';
            ctx.fillText('Total depth: '+Math.floor(depth*10)/10+'cm',center.x,center.y+40);
            ctx.fillText('Babies Made: '+BabyCount,center.x,center.y+70);
            if(Date.now() > endTime+2000){
                ctx.fillText('Flick it to retry',center.x,center.y+100);
            }
        }
	}
    //*************************************************
    //*************************************************
        
    function getDistance(x1,y1,x2,y2){
        return Math.abs(Math.sqrt(Math.pow(x1-x2,2)+Math.pow(y1-y2,2)));
    }

	//*** INPUT SECTION **//
    window.addEventListener('keyup',function(e){
        e.preventDefault();
        if(e.key == 'Escape'){
            //do nothing
        } else {
            if(start.x < 0){
                inputEnd();
            }
        }
    });
        
    window.addEventListener('keydown',function(e){
        e.preventDefault();
        if(e.key=='Escape'){
            //pause the game
            console.log("PAUSE / UNPAUSE");
            pause = !pause;
        } else {
            if(!pause){
                if(startTime < 1){
                    startTime = Date.now();
                }
            }
        }
    });

    window.addEventListener('resize',function(evt){
        evt.preventDefault();
        scaleCanvas();
    });


    window.addEventListener('mousedown',inputStart,false);
    window.addEventListener('mousemove',inputMove,false);
    window.addEventListener('mouseup',inputEnd,false);

    window.addEventListener('touchstart',inputStart, false);
    window.addEventListener('touchmove', inputMove,false);
    window.addEventListener('touchcancel',inputEnd,false);
    window.addEventListener('touchend',inputEnd,false);

    var start = {x:-1,y:-1};
    var current = {x:-1,y:-1};
    var startTime = 0;
    function inputStart(evt){
        evt.preventDefault();
        if(evt.changedTouches != undefined){
            var touches = evt.changedTouches;
            if(touches.length > 0){
                start.x = touches[0].pageX;
                start.y = touches[0].pageY;
            }
        } else {
            start.x = evt.pageX;
            start.y = evt.pageY;
        }
        current.x = start.x;
        current.y = start.y;
        if(!pause && end < -1){
            startTime = Date.now();
        }
    }

    function inputMove(evt){
        evt.preventDefault();
        if(start.x > -1){
            if(evt.changedTouches != undefined){
                var touches = evt.changedTouches;
                if(touches.length > 0){
                    current.x = touches[0].pageX;
                    current.y = touches[0].pageY;
                }
            } else {
                current.x = evt.pageX;
                current.y = evt.pageY;
            }
        }
    }

    function inputEnd(){
        start.x = -1;
        if(end < -1){
            if(!pause){
                let now = Date.now();
                let effect = (now-startTime)/100;
                if(effect > 30){
                    effect = 30;
                }
                shaker.shake(effect*2, 2)
                ship.shrinkage += 30;
                startTime = 0;
                //if(swimmers.length < 3){
                swimmers.push(new Sperm(ship.x, ship.y, effect*5));
                //}
                ship.flip = !ship.flip
            }
        } else {
            if(Date.now() > endTime+2000){
                eggs = [];
                stds = [];
                babies = [];
                swimmers = [];
                ship.x = center.x;
                BabyCount = 0;
                stdTotalCount = 0;
                eggTotalCount = 0;
                end= -2;
                endTime = 0;
                depth = 0;
                init = false;
            }
        }
    }
	animate();
	</script>
</body>
</html>
