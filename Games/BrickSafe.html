<DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Brick Safe</title>
	<style type="text/css">
		body{
            margin: 0;
            touch-action: none;
            position: fixed;
            -webkit-touch-callout: none !important;
            -webkit-user-select: none !important;
        }
        canvas{
            touch-action: none;
            background-color: #222;
        }
	</style>
</head>
<body id='body'>
	<canvas id='canvas'></canvas>
	<script>
    var speed = 1.5;
    var paddleSpeed = 12;

	var canvas = document.getElementById('canvas');	
    function scaleCanvas(){
		canvas.width = window.innerWidth;
		canvas.height = window.innerHeight;
	}
	var ctx = canvas.getContext('2d');
    

    function Ball(x,y){
        this.x = x; this.y = y;
        this.dx = 1; this.dy = 1;
        this.duplicate = true;
        if(Math.random() < 0.5){
            this.dx = -1;
        }
        if(Math.random() < 0.5){
            this.dy = -1;
        }
        this.draw = function(){
            ctx.fillStyle='#ddd';
            ctx.fillRect(this.x,this.y,40,40);
        }

        this.update = function(){
            if(this.x < 0 || this.x+40 > canvas.width){
                this.dx *= -1;
            }
            if(this.y < 0 || this.y+40 > canvas.height){
                this.dy *= -1;
            }
            this.x += (this.dx*speed);
            this.y += (this.dy*speed);

            if(this.x > (innerWidth/4)*3 && this.duplicate){
                b.push(new Ball(innerWidth/2, innerHeight/2));
                this.duplicate = false;
            } else if(this.x < innerWidth/4 && this.duplicate){
                b.push(new Ball(innerWidth/2, innerHeight/2));
                this.duplicate = false;
            }
            this.draw();
        }
    }

    function Paddle(x,y){
        this.x = x; this.y = y;
        this.dy = this.y;
        this.draw = function(){
            ctx.fillStyle='#ddd';
            ctx.fillRect(this.x,this.y,10,80);
        }

        this.update = function(){
            
            this.draw();
        }
    }

    var b = [];
    b.push(new Ball(innerWidth/2, innerHeight/2));

    //var p = new Paddle(innerWidth/4,innerHeight/2);
    //*************************************************
    //*************************************************
	function animate(){
		window.requestAnimationFrame(animate);
		ctx.clearRect(0,0,innerWidth,innerHeight);
        for(var i = 0; i < b.length; i++){
            b[i].update();    
        }
        
        //p.update();   
	}
    //*************************************************
    //*************************************************

	//*** INPUT SECTION **//
    window.addEventListener('resize',function(evt){
        evt.preventDefault();
        scaleCanvas();
    });
    
    
    window.addEventListener('mousedown',inputStart,false);
    window.addEventListener('mousemove',inputMove,false);
    window.addEventListener('mouseup',inputEnd,false);

    window.addEventListener('touchstart',inputStart, false);
    window.addEventListener('touchmove', inputMove,false);
    window.addEventListener('touchcancel',inputEnd,false);
    window.addEventListener('touchend',inputEnd,false);

    window.addEventListener('keydown',function(evt){
        switch(evt.key){
            case 'ArrowUp':
                p.y -= paddleSpeed;
                break;
            case 'ArrowDown':
                p.y += paddleSpeed;
                break;
            default:
                break;
        }
    });
    
    var start = {x:-1,y:-1};
    function inputStart(evt){
        evt.preventDefault();
        if(evt.changedTouches != undefined){
            var touches = evt.changedTouches;
            if(touches.length > 0){
                start.x = touches[0].pageX;
                start.y = touches[0].pageY;
            }
        } else {
            start.x = evt.pageX;
            start.y = evt.pageY;
        }
    }
    
    function inputMove(evt){
        evt.preventDefault();
        var x = -1; var y = -1;
        if(start.x > -1){
            if(evt.changedTouches != undefined){
                var touches = evt.changedTouches;
                if(touches.length > 0){
                    x = touches[0].pageX;
                    y = touches[0].pageY;
                }
            } else {
                x = evt.pageX;
                y = evt.pageY;
            }
        }
    }
    
    function inputEnd(){
        start.x = -1;
    }
    
    scaleCanvas();
	animate();
	</script>
</body>
</html>