<!DOCTYPE html>
<html>
<head>
  <script type="text/javascript" src="./fw/Chart.bundle.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<style>
  body{ 
    margin:0; 
    font-size: 24pt;
  }
  input{
    font-size: 24pt;
    width: 250px;
  }
  .content{
    border: 1px solid black;
    left: 33%;
    width: 33%;
    margin: auto;
  }
  #activity{
    background-color: #DCDCDC;
    width: 200px;
    height: 80px;
  }

 
</style>
<title>UPDN</title>
</head>
<body id='body'>
<div class="content">
  <div id='chart_area'></div>
  <table id='activity_table'>
    <tr><td><input id='act_name' type='text' placeholder="Activity Name"/></td><td><button type='button' id='add' onclick='createData()'>ADD</button></td></tr>
  </table>
  <button type='button' onclick='clearAll()'>CLEAR</button>&nbsp;<button type='button' onclick='dumpData()'>DUMP</button>
</div>
<script>
  var data = localStorage.getItem('data');
  var keyArray = [];
  var dataSetArray = [];
  if(data != null){
    loadDataSets();
  }

  function loadDataSets(){
    data = localStorage.getItem('data');
    var keyArray = data.split('~');
    console.log('loading data');
    for(var i = 0; i < keyArray.length; i++){
      var datelist = localStorage.getItem(keyArray[i]);
      if(datelist != null){
        var dateOutput = datelist.split('~');
        var ds = new DataSet();
        for(var j = 0; j < dateOutput.length; j++){  
          ds.add(dateOutput[j]);
        }
        dataSetArray.push(ds);
        displayDataKeys();
      }
    }

    //Use datasets to populate chart here
  }

  function displayDataKeys(){
    for(var i = 0; i < dataSetArray.length; i++){
      var body = document.getElementById('body');
      var display = '<div id="activity" name="'+dataSetArray[i].key+'">'+dataSetArray[i].key+'</div>';
      body.append(display);
    }
  }

  function addData(e){
    console.log('adding data');
    var key = e.getAttribute('name');
    for(var i = 0; i < dataSetArray.length; i++){
      if(dataSetArray[i].key == key){
        var d = new Date(Date.now());
        var newDateData = (d.getMonth()+1)+"/"+d.getDate()+"/"+d.getFullYear();
        dataSetArray[i].add(newDateData);
        saveData();
      }
    }
  }

  function createData(){
    console.log('creating data');
    var newKey = document.getElementById('act_name').value;
    var ds = new DataSet();
    ds.key = newKey;
    var d = new Date(Date.now());
    var newDateData = (d.getMonth()+1)+"/"+d.getDate()+"/"+d.getFullYear();
    ds.add(newDateData);
    dataSetArray.push(ds);
    saveData();
  }

  function saveData(){
    console.log('saving data');
    var keys = '';
    for(var i = 0; i < dataSetArray.length; i++){
      console.log('Compiling dataset: '+dataSetArray[i].key);
      keys+=(dataSetArray[i].key+"~");
      var dates = '';
      for(var j = 0; j < dataSetArray[i].events.length; j++){
        dates+= (dataSetArray[i].events[j]+"~");
      }
      console.log('Commiting dataset: '+dataSetArray[i].key + " -- " + dates);
      localStorage.setItem(dataSetArray[i].key,dates);
    }
    localStorage.setItem('data',keys);
    loadDataSets();
  }

  function DataSet(){
    this.key = "";
    this.events = [];

    this.add = function(d){
      this.events.push(d);
    }
  }

  function clearSet(key){
    console.log('clearing set data ' + key);
    for(var i = 0; i < dataSetArray.length; i++){
      if(dataSetArray[i].key == key){
        localStorage.removeItem(dataSetArray[i].key);
        loadDataSets();
      }
    }
  }

  function clearAll(){
    console.log('wiping data');
    localStorage.clear();
  }

  function dumpData(){
    var datasetOUT = '';
    for(var i = 0; i < dataSetArray.length;i++){
      datasetOUT +=(dataSetArray[i].key+"--");
      for(var j = 0; j < dataSetArray[i].events.length;j++){
        datasetOUT += (dataSetArray[i].events[j]);
      }
    }
    var dump = '<p> DUMP : '+ datasetOUT + '</p>';
    document.getElementById('body').append(dump);
  }
</script>
</body>
</html>