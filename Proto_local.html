<!DOCTYPE html>
<html>
<head>
  <script type="text/javascript" src="./fw/Chart.bundle.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<style>
  body{ 
    margin:0; 
    font-size: 24pt;
  }
  input{
    font-size: 24pt;
    width: 250px;
  }
  .content{
    left: 33%;
    width: 33%;
    margin: auto;
  }

  .btn{
  	background-color: #bcbcbc;
  	width: 350px;
  	height: 60px;
  	margin: 5px;
  }
  
  #chart_area{
  	width: 600px;
  	height: 400px;
  	margin: auto;
  }
 
</style>
<title>UPDN</title>
</head>
<body id='body'>
<div class="content">
	<div id='addBTN' class='btn'>Add Data Point</div>
	<div id='clearBTN' class='btn'>Clear</div>
	
</div>
<div id='chart_area'>
	<canvas id="myChart" width="400" height="400"></canvas>
</div>
<script>
	$(document).ready(function(){
		var data;
		var points = []; 

		$('#addBTN').click(function(){
			loadData();
			addData();
		});

		$('#clearBTN').click(function(){
			clearAllData();
		});

		function loadData(){
			points = [];
			data = localStorage.getItem('data');
			if(data != null){
				var pData = data.split('~');
				for(var i = 0; i < pData.length-1; i++){
					pData[i].trim();
					console.log("pushing: " + pData[i]);
					if(pData != ''){
						points.push(pData[i]);
					}
				}
			}
			console.log('Data loaded '+points);
		}

		function addData(){
			var d = new Date(Date.now());
			var nd = (d.getMonth()+1)+"/"+d.getDate()+"/"+d.getFullYear()+"~";
			points.push(nd);
			console.log('Data added: '+nd);
			saveData();
			displayData();
		}

		function saveData(){
			var d = '';
			for(var i = 0; i < points.length;i++){
				var out = points[i];
				if(i != points.length-1){
					out += '~';
				}
				d+= out;
			}
			localStorage.setItem('data', d);
			console.log('Data saved');
			
		}

		function displayData(){
			loadData();
			// clearDisplayPoints();
			// for(var i = 0; i < points.length-1; i++){
			// 	if(points[i] != ''){
			// 		$('body').append('<div class="datapoint">'+points[i]+'</div><br class="datapoint"/>');
			// 	}
			// }
			//$('.content').prepend('<div class="btn" id="name">BUTTON</div>');
			chartData();
			console.log('Data displayed');

		}

		function clearDisplayPoints(){
			$('.datapoint').each(function(){
				$(this).remove();
			});
			console.log('Display cleared');
		}

		function clearAllData(){
			localStorage.clear();
			clearDisplayPoints();
			console.log('Data cleared');
		}

		function chartData(){
			var uniquePoints = [];
			var pointCounts = [];
			var prevPoint = points[0];
			var count = 1;
			for(var i = 1; i < points.length;i++){
				if(points[i] != prevPoint){
					console.log("UNMATCHED: "+points[i]+" vs "+prevPoint);
					if(i ==1){
						uniquePoints.push(points[0]);
						pointCounts.push(1);
					}
					pointCounts.push(count);
					uniquePoints.push(points[i]);
					prevPoint = points[i];
					count = 1;
				} else {
					count++;
				}
			}
			pointCounts.push(count);
			uniquePoints.push(prevPoint);
			var ctx = document.getElementById("myChart").getContext('2d');
			var gradient = ctx.createLinearGradient(0,300,0,350);
			gradient.addColorStop(0, '#DCDCDC88');
			gradient.addColorStop(1, '#FFFFFF88');
			//ctx.fillStyle = gradient;
			var myChart = new Chart(ctx, {
			    type: 'line',
			    data: {
			        labels: uniquePoints,
			        datasets: [{
			            label: 'Smoking',
			            data: pointCounts,
			            backgroundColor: gradient,//'#38F24C',
			            borderColor: '#CDCDCD',
			            borderWidth: 1
			        }]
			    },
			    options: {
			        scales: {
			            yAxes: [{
			                ticks: {
			                    beginAtZero:true
			                }
			            }]
			        }
			    }
			});
			console.log(myChart.scaleService);

		}

		displayData();

		var Activity = function(name, color){
			this.name = name;
			this.color = color;
			this.pointCounts = [];
			this.uniquePoints = [];

		}
	});
</script>
</script>
</body>
</html>