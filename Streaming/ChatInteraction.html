<DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>BLANK CANVAS</title>
	<style type="text/css">
		body{
            margin: 0;
            overflow: hidden;
        }
        img{
            width: 100%;
            height: 100%;
        }
	</style>
    <script src='../Util/tmi.min.js'></script>
    <script src='../Util/chat.js'></script>
</head>
<body id='body'>
    <img id='imgbg' src=""/>
	<script>
    var gifQueue = [];
        
    var timer = 0;
    function update(){
        window.requestAnimationFrame(update);
         for(var i = 0; i < messages.length; i++){
             if(!messages[i].shown){
                 console.log(messages[i].msg + " - " + messages[i].user);
                 if(messages[i].msg[0] == "!"){
                     //Command
                     var strData = messages[i].msg.split(" ");
                     for(var s = 0; s < strData.length; s++){
                         if(strData[0] == "!gif"){
                             //Change chat bg gif
                             var url = "https://i.giphy.com/"+strData[1]+"/source.gif";
                             gifQueue.push(url);
                             //document.getElementById("imgbg").src = url;
                         }
                     }
                 }
                 messages[i].shown = true;
             }
         }
        
        if(Date.now() > timer){
            if(gifQueue.length > 0){
                document.getElementById("imgbg").src = gifQueue[0];
                timer = Date.now()+5000;
                gifQueue.shift();
            } else {
                document.getElementById("imgbg").src = "";
            }
        }
    }
        
    update();
	</script>
</body>
</html>
