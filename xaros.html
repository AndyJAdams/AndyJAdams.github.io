<DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Project XAROS</title>
<style>
body{
	margin: 0;
}
</style></head>
<body>
<canvas id='canvas'></canvas>
<script>
var canvas = document.querySelector('canvas');
function scaleCanvas(){
	canvas.width = window.innerWidth;
	canvas.height = window.innerHeight;
}
scaleCanvas();
var ctx = canvas.getContext('2d');

function Menu(x,y){
	this.x = x;
	this.y = y;
	this.left = undefined;
	this.right = undefined;
	this.up = undefined;
	this.draw = function(){
		//ctx.fillRect(this.x-30,this.y-30,60,60); //Touch point
		ctx.beginPath();
		ctx.moveTo(this.x-30, this.y-30);
		ctx.lineTo(this.x+30, this.y-30);
		ctx.lineTo(this.x+30, this.y+30);
		ctx.lineTo(this.x-30, this.y+30);
		ctx.lineTo(this.x-30, this.y-30);
		ctx.stroke();
		ctx.closePath();
		ctx.fillRect(this.x-100, this.y-30, 60,60); //Option left
		ctx.fillRect(this.x-30, this.y-100, 60,60); //Option up
		ctx.fillRect(this.x+40, this.y-30, 60,60);
	}

	this.update = function(){
		this.draw();
	}
}

var menu = undefined;

function animate(){
	window.requestAnimationFrame(animate);
	ctx.clearRect(0,0,innerWidth, innerHeight);

	if(menu != undefined){
		menu.update();
	}	
}

var drag = false;
canvas.addEventListener('mousedown',function(e){
	menu = new Menu(e.pageX, e.pageY);
	drag = true;
})

canvas.addEventListener('mouseup', function(e){
	menu = undefined;
	drag = false;
})

function startup(){
	canvas.addEventListener('touchstart', handlestart, false);
	canvas.addEventListener('touchend', handleend, false);
	canvas.addEventListener('touchcancel', handlecancel, false);
	canvas.addEventListener('touchmove', handlemove, false);
	console.log('initialized');
}

function handlestart(evt){
	evt.preventDefault();
	console.log('touch start');
	var touches = evt.changedTouches;
	for(var i = 0; i < touches.length; i++){
		ongoingTouches.push(copyTouch(touches[i]));
		if(i == 0){
			menu = new Menu(touches[0].pageX, touches[0].pageY);
		}
	}

}

function handlemove(evt){
	evt.preventDefault();
	var touches = evt.changedTouches;
	for(var i = 0; i < touches.length; i++){
		var idx = ongoingTouchIndexById(touches[i].identifier);
		if(idx >= 0){
			ongoingTouches.splice(idx,1,copyTouch(touches[i]));
		}
	}
}

function handleend(evt){
	evt.preventDefault();
	var touches = evt.changedTouches;
	for(var i = 0; i < touches.length; i++){
		var idx = ongoingTouchIndexById(touches[i].identifier);
		if(idx >= 0){
			ongoingTouches.splice(idx, 1);
			
		}
	}
	menu = undefined;
}

function handlecancel(evt){
	evt.preventDefault();
	var touches = evt.changedTouches;
	for(var i = 0; i < touches.length; i++){
		var idx = ongoingTouchIndexById(touches[i].identifier);
		ongoingTouches.splice(idx, 1);

	}
	menu = undefined;
}

function copyTouch(touch){
	return {identifier: touch.identifier,pageX: touch.pageX, pageY: touch.pageY};
}

function ongoingTouchIndexById(idToFind) {
  for (var i = 0; i < ongoingTouches.length; i++) {
    var id = ongoingTouches[i].identifier;
    
    if (id == idToFind) {
      return i;
    }
  }
  return -1;    // not found
}

startup();
animate();
</script>
</body>
</html>